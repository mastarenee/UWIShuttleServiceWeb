{% extends "template.html" %}
{% block content %}
<h4> Shuttle & Student Insights </h4>

<div class="row">

      <div class="col-sm-2 rate_wrap">

        <span class = "rate_heading"> Registered Travallers </span>
        <span class = "rate_metric"> {% print(registered_users) %} </span>
        <small>  <span class="rate_metric_pos"> Eligible Persons </span> </small>

      </div>

      <div class="col-sm-2 rate_wrap">

        <span class = "rate_heading"> In Arrears Travallers </span>
        <span class = "rate_metric"> {% print(arrears_registered_users) %} </span>
        <small>  <span class="rate_metric_neg"> Outstanding Payments </span> </small>

      </div>

      <div class="col-sm-2 rate_wrap">

        <span class = "rate_heading"> Routes Completed </span>
        <span class = "rate_metric"> {% print(total_shuttles) %} </span>
        <small>  <span class="rate_metric_pos">+13.00%</span> (7 Days) </small>

      </div>

    </div>

    <hr/>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.min.js"></script>

    <style>
      .bgwhite{
        background:#fff;
        padding:20px;
        box-shadow: 1px 1px 1px #ddd;
      }

      .nopadding{
        padding-left:0px !important;
        padding-right:0px !important;
      }

      .caseIt{
        background:#fff;
        padding-top:10px;
        padding-bottom:10px;
        border-right:1px solid #eee;
        border-bottom:1px solid #eee;
      }

      .caseIt:hover{
        background:#fefdfd;
        transition: all 0.5s ease-in-out;
      }

      .insights-col{
        padding:0px !important;

      }

      .insights-card{
        border-right:0px;
        border-top:0px;
        border-radius: 0px;
        border-color:rgba(133, 133, 133, 0.05);
      }

      .insights-card .card-title{
        font-size: 14px;
        min-height: 10px;
      }
    </style>
    <form>  

    <div class="row" style = "background:#fff;margin-bottom: 40px;padding:10px;">

        <div class="col-sm-5"> 
            <br/><br/>
            <canvas id="chart-area" width="100%" height="100"></canvas>
            <br/><br/>
        </div>
        
        <div class="col-sm-7"> 

            <h4> Shuttle Quick Stats </h4>
         <p> The shuttle statistic given here provide insights into how the students are using the shuttle service on a daily basis</p>
       
         
          <div class="row">
      {% for shuttle in bus_options: %}

      <div class="col-sm-4 insights-col">
        <div class="card insights-card">
          <div class="card-body">
            <h5 class="card-title"> {% print(shuttle[0]) %} </h5>
            <div class="card-text card-stats">
              <div> Total Students: <span class = "float-right">{% print(shuttle[3]) %} </span> </div>
              <div> Total Trips: <span class = "float-right">{% print(shuttle[1]) %} </span> </div>
              <br/>
            </div>
          </div>
        </div>
      </div>        
    {% endfor %}
      </div> </div>

  </div>
    

        <!-- import plugin script -->   
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
        
        <script src="{{ url_for('static',     filename='js/Chart.min.js') }}"></script>
        <script src="{{ url_for('static',     filename='js/utils.js') }}"></script>
  
        <script>

            
jQuery(document).ready(function($){
    
    var _data;
    var _labels;
    
    $.ajax({
    url: "/get_chart_data",
    type: "get",
    data: {vals: ''},
    success: function(response) {
        full_data = JSON.parse(response.payload);
        console.log(full_data)
        _data = full_data['data'];
        _labels = full_data['labels'];

        console.log(_data)
        console.log(_labels)

        if (response){
            runChart(_data, _labels);
        }
    },

    });
 
    function runChart(_data, _labels){
		
		var config = {
			type: 'pie',
			data: {
				datasets: [{
					data: _data,
					backgroundColor: [
						window.chartColors.red,
						window.chartColors.orange,
						window.chartColors.yellow,
						window.chartColors.green,
						window.chartColors.blue,
					],
					label: 'Dataset 1'
				}],
				labels: _labels
			},
			options: {
				responsive: true
			}
		};

		var ctx = document.getElementById('chart-area').getContext('2d');
		window.myPie = new Chart(ctx, config);

		var colorNames = Object.keys(window.chartColors);
    }
});
            </script>

  {% endblock %}
