{% extends "template.html" %}
{% block content %}

<style>
    /* Always set the map height explicitly to define the size of the div
    * element that contains the map. */
    #map {
        height: 600px;
        width:100%;
    }

    .nopadding{
      padding:0px !important;
    }
    /* Optional: Makes the sample page fill the window. */
    html, body {
        height: 100%;
        margin: 0;
        padding: 0;
    }
</style>


<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDwuOMdmS1fHUiUju2mMm-_xdaYz9VDIi4&callback=initMap"
async defer></script>

<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<!------ Include the above in your HEAD tag ---------->
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/timepicker/1.3.5/jquery.timepicker.min.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/timepicker/1.3.5/jquery.timepicker.min.js"></script>

<div class = "col-sm-7">
    
    <h4> Shuttle - {% print( shuttle_info.to_dict()['NAME'] ) %}</h4>
  
  </div>


  <div class = "row">

    <div class = "col-sm-6 card shadow">
        
        <div class="card-body">
      {% print(error) %}
      
    <form class="pt-3 needs-validation" id = "routesForm" action = "/routes/update-complete/{% print(shuttle_id) %}" method="POST"> 

        <div class="mb-3">
          <label for="username">Shuttle Name <pan class = "required"> * </span></label>
          <input type="text" class="form-control" id="name" name = "name" value = "{% print( shuttle_info.to_dict()['NAME'] ) %}" placeholder="Gaobo Gate 2 to Suzhou Station" required>
          <div class="invalid-feedback" style="width: 100%;">
              Shuttle Name is required.
          </div>
        </div>

        
        <div class="mb-3">
          <label for="description">Description <span class="text-muted"> (optional) </span></label>
          <textarea class="form-control" id="description" rows="3" name = "description">{% print( shuttle_info.to_dict()['DESCRIPTION']) %}</textarea>
        </div>

        
        <div class="mb-3">
          <label for="notes">Notes <span class="text-muted"> (optional) </span></label>
          <textarea class="form-control" id="notes" rows="3" name = "notes">{% print( shuttle_info.to_dict()['NOTE']) %}</textarea>
        </div>

        <hr class="mb-4">

        <h4> Geo Coordinates </h4>

        <div class="row">

            <div class="col-sm-6">

                <label class="control-label"> Latitude </label>
                <input id="latitude" name="latitude" type="text" required="required" class="form-control" value = "{% print( latitude ) %}" autocomplete="off"/>

            </div>

            <div class="col-sm-6">

                <label class="control-label"> Longitude </label>
                <input id="longitude" name="longitude" type="text" required="required" class="form-control" value = "{% print( longitude ) %}" autocomplete="off"/>
                
            </div>
        
        </div>

        <hr class="mb-4">

        <h4> Shuttle Times </h4>
        
        <div class="row">

          <div class="col-sm-9">
            <!-- <label for="description">Times <span class="text-muted"> </span> <pan class = "required"> * </span> </label>
            <textarea class="form-control" id="times" rows="3" name = "times"> </textarea>-->

            <div class="row"> 
                <div class="col-md-4">
                  <div class="form-group bootstrap-timepicker">
                      <label class="control-label">Start Time</label>
                      <input id="start" name="start" type="text" required="required" class="form-control start" value = "{% print( shuttle_info.to_dict()['TIMES'].split('to')[0]) %}" autocomplete="off"/>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-group bootstrap-timepicker">
                      <label class="control-label">End Time</label>
                      <input id="end" name="end" type="text" required="required" class="form-control end" value = "{% print( shuttle_info.to_dict()['TIMES'].split('to')[1]) %}" autocomplete="off"/>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-group bootstrap-select">
                      <label class="control-label">Intervals </label>
                      <select class="custom-select d-block w-100" id="interval" name = "interval" required>
                        {% for interval in intervalOptions: %}
                          {% if interval == shuttle_info.to_dict()['interval']: %}
                            <option selected>{% print(interval) %}</option>
                          {% else: %}
                            <option value = "{% print(interval) %}">{% print(interval) %}</option>
                          {% endif %}
                        {% endfor %}
                      </select>
          
                  </div>
                </div>
              </div>

          </div>

          <div class="col-sm-3">
            <label for="days"> Days <span class="text-muted"> </span> <pan class = "required"> * </span> </label>

              <select class="custom-select d-block w-100" id="days" name = "days" required>
                {% for days in dayOptions: %}
                  {% if days == shuttle_info.to_dict()['days']: %}
                    <option selected>{% print(days) %}</option>
                  {% else: %}
                    <option value = "{% print(days) %}">{% print(days) %}</option>
                  {% endif %}
                {% endfor %}
              </select>

          </div>

        </div>

        <hr class="mb-4">
        
        <div class="row">

          <div class="col-sm-12">
            <label for="breaks">Breaks <span class="text-muted"> </span> <pan class = "required"> * </span> </label>
            <textarea class="form-control" id="breaks" rows="3" name = "breaks">{% print( shuttle_info.to_dict()['BREAKS']) %}</textarea>
          </div>
      
        </div>
    
    
        <button class="btn-complete btn btn-primary btn-lg btn-block" type="submit"> Update Shuttle </button>
    
    </form>

    </div>
  </div>

    <div class="col-sm-5"> <img src = "https://maps.googleapis.com/maps/api/staticmap?center={% print( latitude ) %},{% print( longitude ) %}&zoom=12&size=400x700&markers=color:blue|{% print( latitude ) %},{% print( longitude ) %}&maptype=roadmap&key=AIzaSyDwuOMdmS1fHUiUju2mMm-_xdaYz9VDIi4"> </div>

  </div>
    </div>

</div>


<script>

    $('.start, .end').timepicker({
          showInputs: false,
        minuteStep: 1,
      });
    $( "#end, #start" ).change(function() {

    var time = $("#start").val();
    var hours = Number(time.match(/^(\d+)/)[1]);
    var minutes = Number(time.match(/:(\d+)/)[1]);
    var AMPM = time.match(/\s(.*)$/)[1];
    if(AMPM == "PM" && hours<12) hours = hours+12;
    if(AMPM == "AM" && hours==12) hours = hours-12;
    var sHours = hours.toString();
    var sMinutes = minutes.toString();
    if(hours<10) sHours = "0" + sHours;
    if(minutes<10) sMinutes = "0" + sMinutes;
    var time2 = $("#end").val();
    if(time2=="")
    {
      var time2 = "00:00 AM";
    }
    var hours2 = Number(time2.match(/^(\d+)/)[1]);
    var minutes2 = Number(time2.match(/:(\d+)/)[1]);
    var AMPM2 = time2.match(/\s(.*)$/)[1];
    if(AMPM2 == "PM" && hours2<12) hours2 = hours2+12;
    if(AMPM2 == "AM" && hours2==12) hours2 = hours2-12;
    var sHours2 = hours2.toString();
    var sMinutes2 = minutes2.toString();
    if(hours2<10) sHours2 = "0" + sHours2;
    if(minutes2<10) sMinutes2 = "0" + sMinutes2;
    //alert(sHours + ":" + sMinutes);
    var comparehour = sHours2-sHours;
    var comparemin = sMinutes2-sMinutes;
    if(comparehour<0)
    {
      $("#end").val(time);
    }
    else if((comparehour==0) && (comparemin<0))
    {
      $("#end").val(time);
    }
    });

  </script>


<script>
  var map;

  latitude = document.getElementById("latitude").val;
  longitude = document.getElementById("longitude").val;

  function initMap() {

      var myLatLng = {lat: latitude, lng: longitude};

      var map = new google.maps.Map(document.getElementById('map'), {
        zoom: 15,
        center: myLatLng,
        mapTypeId: 'terrain'
      });

      var marker = new google.maps.Marker({
        position: myLatLng,
        map: map,
        title: 'UWI Shuttle'
      });

      marker.setMap(map);
  }

</script>


{% endblock %}